<dashboard version="1.1" theme="dark" hideFilters="true" script="js/route.js">
  <label>DCAP HOME</label>

    <row depends="$never_show$">
        <panel>
            <table id="routing_table">
                <search>
                    <query>
| rest splunk_server=local /services/authentication/current-context
| rename roles as user_roles

```| eval user_roles="dfe_ssphp_service_user_m365"```

| fields username, user_roles
| mvexpand user_roles

| join type=outer user_roles
    [| makeresults format=csv data="user_roles, service, priority
                                    dfe_ssphp_service_user_m365, m365, 01
                                    dfe_ssphp_service_user_aad, aad, 02
                                    dfe_ssphp_service_user_aws, dns, 03
                                    dfe_ssphp_service_user_azure, azure, 04"]
| eval service=coalesce('service',"-"),
       priority=if('service'="-",99,'priority'),
       link_target=if('service'="-",
                      "/en-GB/app/{{app}}{{environment}}/ssphp_foundational_systems_posture",
                      "/en-GB/app/{{app}}{{environment}}/ssphp_foundational_systems_service?form.tkn__service=".'service')

| sort 1 priority

| table link_target

                    </query>
                </search>
            </table>
        </panel>
    </row>

</dashboard>
