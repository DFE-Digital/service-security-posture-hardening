<form theme="dark" version="1.1" script="js/addtags.js">
  <label>Azure CMDB</label>
  <description>Service Security Posture Hardening Programme : v1.5</description>
  
  <fieldset submitButton="false">
    <input type="radio" token="tkn_dashboard_view" searchWhenChanged="true">
      <label>Select Dashboard View</label>
      <choice value="S">Search</choice>
      <choice value="O">Overview</choice>
      <choice value="F">Filters</choice>
      <default>S</default>
      <initialValue>S</initialValue>
      <change>
        <condition value="S">
          <set token="tkn_show_search_panel">S</set>
          <unset token="tkn_show_overview_panel"></unset>
          <unset token="tkn_show_filter_panel"></unset>
        </condition>
        <condition value="O">
          <set token="tkn_show_overview_panel">O</set>
          <unset token="tkn_show_search_panel"></unset>
          <unset token="tkn_show_filter_panel"></unset>
        </condition>
        <condition value="F">
          <set token="tkn_show_filter_panel">F</set>
          <unset token="tkn_show_overview_panel"></unset>
          <unset token="tkn_show_search_panel"></unset>
        </condition>
      </change>
    </input>


    <input type="radio" token="tkn_ds" searchWhenChanged="true">
      <label>Dataset</label>
      <choice value="C">Complete</choice>
      <choice value="R">Resources Only</choice>
      <default>R</default>
      <initialValue>R</initialValue>
      <change>
        <condition value="C">
          <set token="tkn_data_set">ssphp_azure_resource_cmdb_complete.csv</set>
        </condition>
        <condition value="R">
          <set token="tkn_data_set">ssphp_azure_resource_cmdb_resources.csv</set>
        </condition>
      </change>
    </input>


    <input type="multiselect" token="tkn_search_fields" searchWhenChanged="true" depends="$tkn_show_search_panel$">
      <label>Select Fields to Search</label>
      <delimiter>  OR </delimiter>
      <fieldForLabel>ssphp_field_display_text</fieldForLabel>
      <fieldForValue>ssphp_field_name</fieldForValue>
      <search>
        <query>| inputlookup ssphp_azure_fields.csv
| eval ssphp_field_name=ssphp_field_name."=~~~~"
| table ssphp_field_name, ssphp_field_display_text
| append
    [| inputlookup ssphp_azure_fields.csv
| stats values(ssphp_field_name) as ssphp_field_name
| eval ssphp_field_name=mvjoin(ssphp_field_name,"=~~~~ OR ")."=~~~~",ssphp_field_display_text="ALL"]
| sort 0 ssphp_field_display_text</query>
      </search>
      <prefix> (</prefix>
      <suffix>) </suffix>
      <default>ssphp_all_ip_addresses=~~~~ OR ssphp_business_service_index=~~~~ OR ssphp_cost_centre=~~~~ OR ssphp_devops_site=~~~~ OR ssphp_environment=~~~~ OR ssphp_id=~~~~ OR ssphp_level_1=~~~~ OR ssphp_level_1_display_name=~~~~ OR ssphp_level_2=~~~~ OR ssphp_level_2_display_name=~~~~ OR ssphp_location=~~~~ OR ssphp_name=~~~~ OR ssphp_parent_business=~~~~ OR ssphp_portfolio=~~~~ OR ssphp_private_ip_address=~~~~ OR ssphp_product=~~~~ OR ssphp_provisioning_state=~~~~ OR ssphp_public_ip_address=~~~~ OR ssphp_resource_group=~~~~ OR ssphp_resource_type_category=~~~~ OR ssphp_resource_type_type=~~~~ OR ssphp_service=~~~~ OR ssphp_service_line=~~~~ OR ssphp_service_name=~~~~ OR ssphp_service_offering=~~~~ OR ssphp_service_team=~~~~ OR ssphp_sro=~~~~ OR ssphp_state=~~~~ OR ssphp_subscription=~~~~ OR ssphp_subscription_display_name=~~~~ OR ssphp_tech_contact_email=~~~~ OR ssphp_tech_dir_arch_partner=~~~~ OR ssphp_tech_dir_serv_mgmt_contact=~~~~ OR ssphp_tenant=~~~~ OR ssphp_tenant_name=~~~~ OR ssphp_type=~~~~</default>
      <initialValue>ssphp_all_ip_addresses=~~~~ OR ssphp_business_service_index=~~~~ OR ssphp_cost_centre=~~~~ OR ssphp_devops_site=~~~~ OR ssphp_environment=~~~~ OR ssphp_id=~~~~ OR ssphp_level_1=~~~~ OR ssphp_level_1_display_name=~~~~ OR ssphp_level_2=~~~~ OR ssphp_level_2_display_name=~~~~ OR ssphp_location=~~~~ OR ssphp_name=~~~~ OR ssphp_parent_business=~~~~ OR ssphp_portfolio=~~~~ OR ssphp_private_ip_address=~~~~ OR ssphp_product=~~~~ OR ssphp_provisioning_state=~~~~ OR ssphp_public_ip_address=~~~~ OR ssphp_resource_group=~~~~ OR ssphp_resource_type_category=~~~~ OR ssphp_resource_type_type=~~~~ OR ssphp_service=~~~~ OR ssphp_service_line=~~~~ OR ssphp_service_name=~~~~ OR ssphp_service_offering=~~~~ OR ssphp_service_team=~~~~ OR ssphp_sro=~~~~ OR ssphp_state=~~~~ OR ssphp_subscription=~~~~ OR ssphp_subscription_display_name=~~~~ OR ssphp_tech_contact_email=~~~~ OR ssphp_tech_dir_arch_partner=~~~~ OR ssphp_tech_dir_serv_mgmt_contact=~~~~ OR ssphp_tenant=~~~~ OR ssphp_tenant_name=~~~~ OR ssphp_type=~~~~</initialValue>
    </input>

    <input type="text" token="tkn_search_text" searchWhenChanged="true" depends="$tkn_show_search_panel$">
      <label>Search Text</label>
      <default></default>
    </input>



    <input type="dropdown" token="tkn_f_ten" searchWhenChanged="true" depends="$tkn_show_filter_panel$">
      <label>Tenancy</label>
      <choice value="*">ALL</choice>
      <default>ALL</default>
      <initialValue>*</initialValue>
      <fieldForLabel>ten</fieldForLabel>
      <fieldForValue>ten</fieldForValue>
      <search>
        <query>
| inputlookup $tkn_data_set$
| stats values(ssphp_tenant_name) as ten
| mvexpand ten
        </query>
      </search>
      <change>
        <set token="tkn_filter_ten">$value$</set>
      </change>
    </input>


    <input type="dropdown" token="tkn_f_sub" searchWhenChanged="true" depends="$tkn_show_filter_panel$">
      <label>Subscription</label>
      <choice value="*">ALL</choice>
      <default>ALL</default>
      <initialValue>*</initialValue>
      <fieldForLabel>sub</fieldForLabel>
      <fieldForValue>sub</fieldForValue>
      <search>
        <query>
| inputlookup $tkn_data_set$ where (ssphp_tenant_name=$tkn_filter_ten|s$)
| stats values(ssphp_subscription_display_name) as sub
| mvexpand sub
        </query>
      </search>
      <change>
        <set token="tkn_filter_sub">$value$</set>
      </change>
    </input>



    <input type="dropdown" token="tkn_f_rg" searchWhenChanged="true" depends="$tkn_show_filter_panel$">
      <label>Resource Group</label>
      <choice value="*">ALL</choice>
      <default>ALL</default>
      <initialValue>*</initialValue>
      <fieldForLabel>rg</fieldForLabel>
      <fieldForValue>rg</fieldForValue>
      <search>
        <query>
| inputlookup $tkn_data_set$ where (ssphp_tenant_name=$tkn_filter_ten|s$ AND ssphp_subscription_display_name=$tkn_filter_sub|s$)
| stats values(ssphp_resource_group) as rg
| mvexpand rg
        </query>
      </search>
      <change>
        <set token="tkn_filter_rg">$value$</set>
      </change>
    </input>


    <input type="dropdown" token="tkn_f_type" searchWhenChanged="true" depends="$tkn_show_filter_panel$">
      <label>Resource Type</label>
      <choice value="*">ALL</choice>
      <default>ALL</default>
      <initialValue>*</initialValue>
      <fieldForLabel>type</fieldForLabel>
      <fieldForValue>type</fieldForValue>
      <search>
        <query>
| inputlookup $tkn_data_set$ where (ssphp_tenant_name=$tkn_filter_ten|s$ AND ssphp_subscription_display_name=$tkn_filter_sub|s$ AND ssphp_resource_group=$tkn_filter_rg|s$)
| stats values(ssphp_resource_type_type) as type
| mvexpand type
        </query>
      </search>
      <change>
        <set token="tkn_filter_type">$value$</set>
      </change>
    </input>
  </fieldset>


  <!-- =================================================================================================================================================-->

    <row depends="$never_show$">
    <panel>
      <table>
        <search>
          <query>
| makeresults
| eval app=$env:app|s$
| table app
          </query>
          <done>
            <set token="tkn_current_app">$result.app$</set>
          </done>
        </search>
      </table>
    </panel>
  </row>


  <!-- =================================================================================================================================================-->

  <row>
    <panel depends="$nevershow$">
      <table>
        <search>
          <query>
| makeresults
| eval search_text=$tkn_search_fields|s$,
       search_text=replace(search_text,"~~~~","\"*$tkn_search_text$*\"")
| table search_text
          </query>
          <done>
            <set token="tkn_final_search">$result.search_text$</set>
          </done>
        </search>
      </table>
    </panel>

    <panel depends="$nevershow$">
      <html>
        <p>$tkn_final_search$</p>
      </html>
    </panel>
  </row>

  <!-- ========================================= SEARCH ROW ========================================================================================================-->

  <row depends="$tkn_show_search_panel$">
    <panel depends="$nevershow$">
      <html>
        <style>
          .yellow{
            color:yellow !important;
          }
        </style>
      </html>
    </panel>

    <panel>
      <table>
        <title># Resources : $tkn_event_count_search$</title>
        <search>
          <query>
| inputlookup $tkn_data_set$
| search $tkn_final_search$

``` Get the # findings for the resource ```
```| lookup ssphp_resource_azure_finding_count.csv ssphp_norm_resource_id as ssphp_id output count as ssphp_resource_azure_finding_count```
| join type=outer ssphp_id
    [| tstats summariesonly=false count, values(findings.ssphp_norm_severity) as ssphp_norm_severity
      FROM datamodel=SSPHP.findings
      WHERE (findings.ssphp_norm_tech_source="Azure" AND findings.ssphp_norm_use_case="findings")
            [| tstats summariesonly=false max(findings.SSPHP_RUN) as findings.SSPHP_RUN FROM datamodel=SSPHP.findings WHERE findings.ssphp_norm_tech_source="Azure" AND findings.ssphp_norm_use_case="findings" | return findings.SSPHP_RUN]
      BY findings.ssphp_norm_time,
         findings.ssphp_norm_tech_source, 
         findings.ssphp_norm_use_case,
         findings.ssphp_norm_resource_id,
         findings.ssphp_norm_title,
         findings.ssphp_norm_original_events,
         findings.ssphp_norm_resource
| rename findings.ssphp_norm_resource_id as ssphp_id, findings.* as *
| stats count as ssphp_resource_azure_finding_count, sum(eval(if(like(ssphp_norm_severity,"%IG1%"),1,0))) as ssphp_resource_azure_finding_ig1_count by ssphp_id]
| fillnull value=0 ssphp_resource_azure_finding_count, ssphp_resource_azure_finding_ig1_count

| eval drilldown_resource_id='ssphp_id'
| rename * as zz_*, zz_drilldown_resource_id as drilldown_resource_id, zz_ssphp_resource_azure_finding_count as ssphp_resource_azure_finding_count, zz_ssphp_resource_azure_finding_ig1_count as ssphp_resource_azure_finding_ig1_count

```| foreach * [| eval rep=$tkn_search_text|s$, &lt;&lt;FIELD&gt;&gt;=replace(&lt;&lt;FIELD&gt;&gt;,'rep',"~!span class=\"yellow\"~!".'rep'."~!/span~!")]```
| foreach zz_* [| rex field=&lt;&lt;FIELD&gt;&gt; mode=sed "s/(?i)($tkn_search_text$)/~!span class=\"yellow\"~!\1~!\/span~!/g"]
| rename zz_* as *

| rename [| inputlookup ssphp_azure_fields.csv
| eval s="\"".ssphp_field_name."\" AS \"".ssphp_field_display_text."\""
| stats values(s) as s
| eval s=mvjoin(s,", ")
    | return $s]

| rename ssphp_resource_azure_finding_count as "Total # Findings for Resource", ssphp_resource_azure_finding_ig1_count as "Total # IG1 Findings for Resource"
| eventstats count as event_count
          </query>
          <earliest>-2d@d</earliest>
          <latest>now</latest>
          <done>
            <set token="tkn_event_count_search">$result.event_count$</set>
          </done>
        </search>
        <option name="drilldown">cell</option>
        <fields>"Tenancy", "Tenancy Name", "Subscription", "Subscription Name", "Resource Group", "Resource ID", "Resource", "Business Service Index", "Category", "Environemt", "Location", "Provisioning State", "Resource Type", "State", "IP Address : All", "IP Address : Private", "IP Address : Public", "Tag : Architecture Partner", "Tag : Contact EMail", "Tag : Cost Centre", "Tag : Devops Site", "Tag : Parent Business", "Tag : Porfolio", "Tag : Product", "Tag : SRO", "Tag : Service", "Tag : Service Line", "Tag : Service Management Contact", "Tag : Service Name", "Tag : Service Offering", "Tag : Service Team", "Taxonomy : Group", "Taxonomy : Group Name", "Taxonomy : Service", "Taxonomy : Service Name", "Type", "Total # Findings for Resource", "Total # IG1 Findings for Resource"</fields>
        <drilldown>
          <link target="_blank">/app/$tkn_current_app$/ssphp_azure_cmdb_dashboard_drilldown?tkn_drilldown_resource_id=$row.drilldown_resource_id$</link>
        </drilldown>
      </table>
    </panel>
  </row>




  <!-- ============================================ OVERIEW ROW =====================================================================================================-->


  <row depends="$tkn_show_overview_panel$">
    <panel>
      <title>Tenancies > Subscriptions</title>
      <viz type="treemap_app.treemap">
        <search>
          <query>
| inputlookup $tkn_data_set$

| stats dc(ssphp_resource_group) as "# Resource Groups" by ssphp_tenant_name, ssphp_subscription_display_name
          </query>
        </search>
        <option name="height">500</option>
        <option name="treemap_app.treemap.colorMode">categorical</option>
        <option name="treemap_app.treemap.maxCategories">10000</option>
        <option name="treemap_app.treemap.maxColor">#3fc77a</option>
        <option name="treemap_app.treemap.minColor">#d93f3c</option>
        <option name="treemap_app.treemap.numOfBins">6</option>
        <option name="treemap_app.treemap.showLabels">true</option>
        <option name="treemap_app.treemap.showLegend">false</option>
        <option name="treemap_app.treemap.showTooltip">true</option>
        <option name="treemap_app.treemap.useColors">true</option>
        <option name="treemap_app.treemap.useZoom">true</option>
        <drilldown>
          <set token="tkn_dd_ten">$row.ssphp_tenant_name$</set>
          <set token="tkn_dd_subs">$row.ssphp_subscription_display_name$</set>
        </drilldown>
      </viz>
    </panel>

    <panel>
      <title>Resource Groups > Types</title>
      <viz type="treemap_app.treemap">
        <search>
          <query>
| inputlookup $tkn_data_set$ where ssphp_subscription_display_name=$tkn_dd_subs|s$

| stats dc(ssphp_id) as "# resources" by ssphp_resource_group, ssphp_resource_type_type
        </query>
        </search>
        <option name="height">500</option>
        <option name="treemap_app.treemap.colorMode">categorical</option>
        <option name="treemap_app.treemap.maxCategories">10000</option>
        <option name="treemap_app.treemap.maxColor">#3fc77a</option>
        <option name="treemap_app.treemap.minColor">#d93f3c</option>
        <option name="treemap_app.treemap.numOfBins">6</option>
        <option name="treemap_app.treemap.showLabels">true</option>
        <option name="treemap_app.treemap.showLegend">false</option>
        <option name="treemap_app.treemap.showTooltip">true</option>
        <option name="treemap_app.treemap.useColors">true</option>
        <option name="treemap_app.treemap.useZoom">true</option>
        <drilldown>
          <set token="tkn_dd_rg">$row.ssphp_resource_group$</set>
          <set token="tkn_dd_type">$row.ssphp_resource_type_type$</set>
        </drilldown>
      </viz>
    </panel>
  </row>

  <!-- =================================================================================================================================================-->

  <row depends="$tkn_show_overview_panel$">
    <panel>
      <html>
        <p>Tenancy : $tkn_dd_ten$</p>
      </html>
    </panel>
    <panel>
      <html>
        <p>Subscription : $tkn_dd_subs$</p>
      </html>
    </panel>
    <panel>
      <html>
        <p>Resource Group : $tkn_dd_rg$</p>
      </html>
    </panel>
    <panel>
      <html>
        <p>Resource Type : $tkn_dd_type$</p>
      </html>
    </panel>
  </row>

  <!-- =================================================================================================================================================-->

  <row depends="$tkn_show_overview_panel$">
    <panel>
      <table>
        <title># Resources : $tkn_record_count_overview$</title>
        <search>
          <query>
| inputlookup $tkn_data_set$ where (ssphp_tenant_name=$tkn_dd_ten|s$ AND ssphp_subscription_display_name=$tkn_dd_subs|s$ AND ssphp_resource_group=$tkn_dd_rg|s$ AND ssphp_resource_type_type=$tkn_dd_type|s$)

``` Get the # findings for the resource ```
```| lookup ssphp_resource_azure_finding_count.csv ssphp_norm_resource_id as ssphp_id output count as ssphp_resource_azure_finding_count```
| join type=outer ssphp_id
    [| tstats summariesonly=false count, values(findings.ssphp_norm_severity) as ssphp_norm_severity
      FROM datamodel=SSPHP.findings
      WHERE (findings.ssphp_norm_tech_source="Azure" AND findings.ssphp_norm_use_case="findings")
            [| tstats summariesonly=false max(findings.SSPHP_RUN) as findings.SSPHP_RUN FROM datamodel=SSPHP.findings WHERE findings.ssphp_norm_tech_source="Azure" AND findings.ssphp_norm_use_case="findings" | return findings.SSPHP_RUN]
      BY findings.ssphp_norm_time,
         findings.ssphp_norm_tech_source, 
         findings.ssphp_norm_use_case,
         findings.ssphp_norm_resource_id,
         findings.ssphp_norm_title,
         findings.ssphp_norm_original_events,
         findings.ssphp_norm_resource
| rename findings.ssphp_norm_resource_id as ssphp_id, findings.* as *
| stats count as ssphp_resource_azure_finding_count, sum(eval(if(like(ssphp_norm_severity,"%IG1%"),1,0))) as ssphp_resource_azure_finding_ig1_count by ssphp_id]
| fillnull value=0 ssphp_resource_azure_finding_count, ssphp_resource_azure_finding_ig1_count

| eval drilldown_resource_id='ssphp_id'
| rename * as zz_*, zz_drilldown_resource_id as drilldown_resource_id, zz_ssphp_resource_azure_finding_count as ssphp_resource_azure_finding_count, zz_ssphp_resource_azure_finding_ig1_count as ssphp_resource_azure_finding_ig1_count

```| foreach * [| eval rep=$tkn_search_text|s$, &lt;&lt;FIELD&gt;&gt;=replace(&lt;&lt;FIELD&gt;&gt;,'rep',"~!span class=\"yellow\"~!".'rep'."~!/span~!")]```
| foreach zz_* [| rex field=&lt;&lt;FIELD&gt;&gt; mode=sed "s/(?i)($tkn_search_text$)/~!span class=\"yellow\"~!\1~!\/span~!/g"]
| rename zz_* as *

| rename [| inputlookup ssphp_azure_fields.csv
| eval s="\"".ssphp_field_name."\" AS \"".ssphp_field_display_text."\""
| stats values(s) as s
| eval s=mvjoin(s,", ")
    | return $s]

| rename ssphp_resource_azure_finding_count as "Total # Findings for Resource", ssphp_resource_azure_finding_ig1_count as "Total # IG1 Findings for Resource"
| eventstats count as event_count
          </query>
          <done>
            <set token="tkn_record_count_overview">$result.event_count$</set>
          </done>
        </search>
        <option name="drilldown">cell</option>
        <fields>"Tenancy", "Tenancy Name", "Subscription", "Subscription Name", "Resource Group", "Resource ID", "Resource", "Business Service Index", "Category", "Environemt", "Location", "Provisioning State", "Resource Type", "State", "IP Address : All", "IP Address : Private", "IP Address : Public", "Tag : Architecture Partner", "Tag : Contact EMail", "Tag : Cost Centre", "Tag : Devops Site", "Tag : Parent Business", "Tag : Porfolio", "Tag : Product", "Tag : SRO", "Tag : Service", "Tag : Service Line", "Tag : Service Management Contact", "Tag : Service Name", "Tag : Service Offering", "Tag : Service Team", "Taxonomy : Group", "Taxonomy : Group Name", "Taxonomy : Service", "Taxonomy : Service Name", "Type", "Total # Findings for Resource", "Total # IG1 Findings for Resource"</fields>
        <drilldown>
          <link target="_blank">/app/$tkn_current_app$/ssphp_azure_cmdb_dashboard_drilldown?tkn_drilldown_resource_id=$row.drilldown_resource_id$</link>
        </drilldown>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <!-- ========================================== FILTER ROW =======================================================================================================-->

  <row depends="$tkn_show_filter_panel$">
    <panel>
      <table>
        <title># Resources : $tkn_record_count_filter$</title>
        <search>
          <query>
| inputlookup $tkn_data_set$ where (ssphp_tenant_name=* AND ssphp_subscription_display_name=* AND ssphp_resource_group=$tkn_filter_rg|s$ AND ssphp_resource_type_type=$tkn_filter_type|s$)

``` Get the # findings for the resource ```
```| lookup ssphp_resource_azure_finding_count.csv ssphp_norm_resource_id as ssphp_id output count as ssphp_resource_azure_finding_count```
| join type=outer ssphp_id
    [| tstats summariesonly=false count, values(findings.ssphp_norm_severity) as ssphp_norm_severity
      FROM datamodel=SSPHP.findings
      WHERE (findings.ssphp_norm_tech_source="Azure" AND findings.ssphp_norm_use_case="findings")
            [| tstats summariesonly=false max(findings.SSPHP_RUN) as findings.SSPHP_RUN FROM datamodel=SSPHP.findings WHERE findings.ssphp_norm_tech_source="Azure" AND findings.ssphp_norm_use_case="findings" | return findings.SSPHP_RUN]
      BY findings.ssphp_norm_time,
         findings.ssphp_norm_tech_source, 
         findings.ssphp_norm_use_case,
         findings.ssphp_norm_resource_id,
         findings.ssphp_norm_title,
         findings.ssphp_norm_original_events,
         findings.ssphp_norm_resource
| rename findings.ssphp_norm_resource_id as ssphp_id, findings.* as *
| stats count as ssphp_resource_azure_finding_count, sum(eval(if(like(ssphp_norm_severity,"%IG1%"),1,0))) as ssphp_resource_azure_finding_ig1_count by ssphp_id]
| fillnull value=0 ssphp_resource_azure_finding_count, ssphp_resource_azure_finding_ig1_count

| eval drilldown_resource_id='ssphp_id'
| rename * as zz_*, zz_drilldown_resource_id as drilldown_resource_id, zz_ssphp_resource_azure_finding_count as ssphp_resource_azure_finding_count, zz_ssphp_resource_azure_finding_ig1_count as ssphp_resource_azure_finding_ig1_count

```| foreach * [| eval rep=$tkn_search_text|s$, &lt;&lt;FIELD&gt;&gt;=replace(&lt;&lt;FIELD&gt;&gt;,'rep',"~!span class=\"yellow\"~!".'rep'."~!/span~!")]```
| foreach zz_* [| rex field=&lt;&lt;FIELD&gt;&gt; mode=sed "s/(?i)($tkn_search_text$)/~!span class=\"yellow\"~!\1~!\/span~!/g"]
| rename zz_* as *

| rename [| inputlookup ssphp_azure_fields.csv
| eval s="\"".ssphp_field_name."\" AS \"".ssphp_field_display_text."\""
| stats values(s) as s
| eval s=mvjoin(s,", ")
    | return $s]

| rename ssphp_resource_azure_finding_count as "Total # Findings for Resource", ssphp_resource_azure_finding_ig1_count as "Total # IG1 Findings for Resource"
| eventstats count as event_count
          </query>
          <done>
            <set token="tkn_record_count_filter">$result.event_count$</set>
          </done>
        </search>
        <option name="drilldown">cell</option>
        <fields>"Tenancy", "Tenancy Name", "Subscription", "Subscription Name", "Resource Group", "Resource ID", "Resource", "Business Service Index", "Category", "Environemt", "Location", "Provisioning State", "Resource Type", "State", "IP Address : All", "IP Address : Private", "IP Address : Public", "Tag : Architecture Partner", "Tag : Contact EMail", "Tag : Cost Centre", "Tag : Devops Site", "Tag : Parent Business", "Tag : Porfolio", "Tag : Product", "Tag : SRO", "Tag : Service", "Tag : Service Line", "Tag : Service Management Contact", "Tag : Service Name", "Tag : Service Offering", "Tag : Service Team", "Taxonomy : Group", "Taxonomy : Group Name", "Taxonomy : Service", "Taxonomy : Service Name", "Type", "Total # Findings for Resource", "Total # IG1 Findings for Resource"</fields>
        <drilldown>
          <link target="_blank">/app/$tkn_current_app$/ssphp_azure_cmdb_dashboard_drilldown?tkn_drilldown_resource_id=$row.drilldown_resource_id$</link>
        </drilldown>
      </table>
    </panel>
  </row>
</form>
