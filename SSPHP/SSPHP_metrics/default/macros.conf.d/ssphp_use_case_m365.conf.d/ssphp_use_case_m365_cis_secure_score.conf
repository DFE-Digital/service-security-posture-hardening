[ssphp_use_case_m365_cis_secure_score]
definition = """
search `ssphp_metrics_data_index` sourcetype="m365" "@odata.context" = "https://graph.microsoft.com/beta/$metadata#security/secureScores"
    [| search `ssphp_metrics_data_index` sourcetype="m365" "@odata.context" = "https://graph.microsoft.com/beta/$metadata#security/secureScores"
    | stats max(SSPHP_RUN) as SSPHP_RUN
    | return SSPHP_RUN]
| fields controlScores{}.controlName, controlScores{}.count, controlScores{}.IsApplicable, controlScores{}.description, controlScores{}.implementationStatus, controlScores{}.on, controlScores{}.score, controlScores{}.scoreInPercentage, controlScores*
| rename controlScores{}.* as  controlScores_*

| eval controlScores=mvzip(controlScores_controlName, controlScores_count, "|"),
       controlScores=mvzip(controlScores, controlScores_IsApplicable, "|"),
       controlScores=mvzip(controlScores, controlScores_description, "|"),
       controlScores=mvzip(controlScores, controlScores_implementationStatus, "|"),
       controlScores=mvzip(controlScores, controlScores_on, "|"),
       controlScores=mvzip(controlScores, controlScores_score, "|"),
       controlScores=mvzip(controlScores, controlScores_scoreInPercentage, "|")
| fields controlScores
| mvexpand controlScores
| eval controlScores=split(controlScores,"|")
| eval controlScores_controlName=mvindex(controlScores,0),
       controlScores_count=mvindex(controlScores,1),
       controlScores_IsApplicable=mvindex(controlScores,2),
       controlScores_description=mvindex(controlScores,3),
       controlScores_implementationStatus=mvindex(controlScores,4),
       controlScores_on=mvindex(controlScores,5),
       controlScores_score=mvindex(controlScores,6),
       controlScores_scoreInPercentage=mvindex(controlScores,7)
| fields - controlScores

"""

iseval = 0
