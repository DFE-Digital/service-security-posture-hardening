<dashboard version="1.1" theme="dark" hideFilters="true" script="js/table_cell_color.js">

  <label>Security Posture Continuous Assurance : Posture Dashboard</label>
  <description>v1.3.1</description>

  <init>
    <set token="tkn_colour_red">#D32D41</set>
    <set token="tkn_colour_orange">#EA6A47</set>
    <set token="tkn_colour_green">#B3C100</set>
    <set token="tkn_colour_green">#6AB187</set>
    <set token="tkn_colour_blue">#A5D8DD</set>
  </init>
  
  
  <fieldset submitButton="false">
    <input type="radio" token="tkn_view" searchWhenChanged="true">
      <label>View</label>
      <choice value="a">Absolute</choice>
      <choice value="p">Percentage</choice>
      <default>p</default>
      <initialValue>p</initialValue>
      <change>
        <condition value="a">
          <set token="tkn_show_abs">true</set>
          <unset token="tkn_show_perc"></unset>
        </condition>
        <condition value="p">
          <unset token="tkn_show_abs"></unset>
          <set token="tkn_show_perc">true</set>
        </condition>
      </change>
    </input>
  </fieldset>



<!-- ################### Set Target Service and other Tokens ################### --> 

  <row depends="$never_show$">
    <panel>
      <table>
        <search>
          <query>
  | makeresults
  | eval app=$env:app|s$
  | table app
          </query>
          <done>
            <set token="tkn_current_app">$result.app$</set>
          </done>
        </search>
      </table>
    </panel>
  </row>



<!-- ################### Header Row ################### --> 

<row>
  <panel>
    <html>
      <div id="div_header" style="font-weight:bold;font-size:125%">FOUNDATIONAL SERVICES : COMPLIANT CONTROLS
        <span><a href="ssphp_foundational_systems_dashboard_help" class="btn btn-primary" style="color:black;background-color:grey;text-align:center;display:block;float:right;width:6%;" target="_blank">Dashboard Help</a></span>
      </div> 
    </html>
  </panel>
</row>


<!-- ################### DISPLAY ROWS ################### -->   
  
  <row depends="$tkn_show_abs$">

    <panel>
      <html>
       <style type="text/css">

       #single_abs_aad .svg-container{
       background-color: $tkn_AAD_color$;
       }
       #single_abs_aad .single-result{
       fill: rgb(255,255,255)!important;
       font-size: 300px !important;
       }
       #single_abs_aad .under-label {
          font-size: 25px !important;
          fill: rgb(255,255,255)!important;
       }
       </style>
     </html>
      <single id="single_abs_aad">
        <search>
          <query>
| loadjob savedsearch="nobody:$tkn_current_app$:ssphp_create_dashboard_dataset"
| search line_type="summary" AND ssphp.use_case.foundational_system="AAD"
| table compliant_abs, compliant_color
          </query>
          <done>
            <set token="tkn_AAD_color">$result.compliant_color$</set>
          </done>
        </search>
        <option name="height">200</option>
        <option name="field">text_out</option>
        <option name="underLabel">AAD</option>
        <option name="drilldown">all</option>
        <drilldown>
          <link target="_blank">/app/$tkn_current_app$/ssphp_foundational_systems_service?form.tkn__service=aad</link>
        </drilldown>
      </single>
    </panel>
    
    <panel>
      <html>
       <style type="text/css">

       #single_abs_azure .svg-container{
       background-color: $tkn_AZURE_color$;
       }
       #single_abs_azure .single-result{
       fill: rgb(255,255,255)!important;
       font-size: 300px !important;
       }
       #single_abs_azure .under-label {
          font-size: 25px !important;
          fill: rgb(255,255,255)!important;
       }
       </style>
     </html>
      <single id="single_abs_azure">
        <search>
          <query>
            | loadjob savedsearch="nobody:$tkn_current_app$:ssphp_create_dashboard_dataset"
            | search line_type="summary" AND ssphp.use_case.foundational_system="AZURE"
            | table compliant_abs, compliant_color
          </query>
          <done>
            <set token="tkn_AZURE_color">$result.compliant_color$</set>
          </done>
        </search>
        <option name="height">200</option>
        <option name="field">text_out</option>
        <option name="underLabel">AZURE</option>
        <option name="drilldown">all</option>
        <drilldown>
          <link target="_blank">/app/$tkn_current_app$/ssphp_foundational_systems_service?form.tkn__service=azure</link>
        </drilldown>
      </single>
    </panel>

    <panel>
      <html>
       <style type="text/css">

       #single_abs_dns .svg-container{
       background-color: $tkn_DNS_color$;
       }
       #single_abs_dns .single-result{
       fill: rgb(255,255,255)!important;
       font-size: 300px !important;
       }
       #single_abs_dns .under-label {
          font-size: 25px !important;
          fill: rgb(255,255,255)!important;
       }
       </style>
     </html>
      <single id="single_abs_dns">
        <search>
          <query>
            | loadjob savedsearch="nobody:$tkn_current_app$:ssphp_create_dashboard_dataset"
            | search line_type="summary" AND ssphp.use_case.foundational_system="DNS"
            | table compliant_abs, compliant_color
          </query>
          <done>
            <set token="tkn_DNS_color">$result.compliant_color$</set>
          </done>
        </search>
        <option name="height">200</option>
        <option name="field">text_out</option>
        <option name="underLabel">DNS</option>
        <option name="drilldown">all</option>
        <drilldown>
          <link target="_blank">/app/$tkn_current_app$/ssphp_foundational_systems_service?form.tkn__service=dns</link>
        </drilldown>
      </single>
    </panel>

    <panel>
      <html>
       <style type="text/css">

       #single_abs_m365 .svg-container{
       background-color: $tkn_M365_color$;
       }
       #single_abs_m365 .single-result{
       fill: rgb(255,255,255)!important;
       font-size: 300px !important;
       }
       #single_abs_m365 .under-label {
          font-size: 25px !important;
          fill: rgb(255,255,255)!important;
       }
       </style>
     </html>
      <single id="single_abs_m365">
        <search>
          <query>
            | loadjob savedsearch="nobody:$tkn_current_app$:ssphp_create_dashboard_dataset"
            | search line_type="summary" AND ssphp.use_case.foundational_system="M365"
            | table compliant_abs, compliant_color
          </query>
          <done>
            <set token="tkn_M365_color">$result.compliant_color$</set>
          </done>
        </search>
        <option name="height">200</option>
        <option name="field">text_out</option>
        <option name="underLabel">M365</option>
        <option name="drilldown">all</option>
        <drilldown>
          <link target="_blank">/app/$tkn_current_app$/ssphp_foundational_systems_service?form.tkn__service=m365</link>
        </drilldown>
      </single>
    </panel>
  </row>
  
  <row depends="$tkn_show_perc$">
    <panel>
      <html>
       <style type="text/css">

       #single_perc_aad .svg-container{
       background-color: $tkn_AAD_color$;
       }
       #single_perc_aad .single-result{
       fill: rgb(255,255,255)!important;
       font-size: 120px !important;
       }
       #single_perc_aad .under-label {
          font-size: 25px !important;
          fill: rgb(255,255,255)!important;
       }
       </style>
     </html>
      <single id="single_perc_aad">
        <search>
          <query>
            | loadjob savedsearch="nobody:$tkn_current_app$:ssphp_create_dashboard_dataset"
            | search line_type="summary" AND ssphp.use_case.foundational_system="AAD"
            | table compliant_perc, compliant_color
          </query>
          <done>
            <set token="tkn_AAD_color">$result.compliant_color$</set>
          </done>
        </search>
        <option name="height">200</option>
        <option name="field">text_out</option>
        <option name="underLabel">AAD</option>
        <option name="drilldown">all</option>
        <option name="unit">%</option>
        <drilldown>
          <link target="_blank">/app/$tkn_current_app$/ssphp_foundational_systems_service?form.tkn__service=aad</link>
        </drilldown>
      </single>
    </panel>
    
    <panel>
      <html>
       <style type="text/css">

       #single_perc_azure .svg-container{
       background-color: $tkn_AZURE_color$;
       }
       #single_perc_azure .single-result{
       fill: rgb(255,255,255)!important;
       font-size: 120px !important;
       }
       #single_perc_azure .under-label {
          font-size: 25px !important;
          fill: rgb(255,255,255)!important;
       }
       </style>
     </html>
      <single id="single_perc_azure">
        <search>
          <query>
            | loadjob savedsearch="nobody:$tkn_current_app$:ssphp_create_dashboard_dataset"
            | search line_type="summary" AND ssphp.use_case.foundational_system="AZURE"
            | table compliant_perc, compliant_color
          </query>
          <done>
            <set token="tkn_AZURE_color">$result.compliant_color$</set>
          </done>
        </search>
        <option name="height">200</option>
        <option name="field">text_out</option>
        <option name="underLabel">AZURE</option>
        <option name="drilldown">all</option>
        <option name="unit">%</option>
        <drilldown>
          <link target="_blank">/app/$tkn_current_app$/ssphp_foundational_systems_service?form.tkn__service=azure</link>
        </drilldown>
      </single>
    </panel>

    <panel>
      <html>
       <style type="text/css">

       #single_perc_dns .svg-container{
       background-color: $tkn_DNS_color$;
       }
       #single_perc_dns .single-result{
       fill: rgb(255,255,255)!important;
       font-size: 120px !important;
       }
       #single_perc_dns .under-label {
          font-size: 25px !important;
          fill: rgb(255,255,255)!important;
       }
       </style>
     </html>
      <single id="single_perc_dns">
        <search>
          <query>
            | loadjob savedsearch="nobody:$tkn_current_app$:ssphp_create_dashboard_dataset"
            | search line_type="summary" AND ssphp.use_case.foundational_system="DNS"
            | table compliant_perc, compliant_color
          </query>
          <done>
            <set token="tkn_DNS_color">$result.compliant_color$</set>
          </done>
        </search>
        <option name="height">200</option>
        <option name="field">text_out</option>
        <option name="underLabel">DNS</option>
        <option name="drilldown">all</option>
        <option name="unit">%</option>
        <drilldown>
          <link target="_blank">/app/$tkn_current_app$/ssphp_foundational_systems_service?form.tkn__service=dns</link>
        </drilldown>
      </single>
    </panel>

    <panel>
      <html>
       <style type="text/css">

       #single_perc_m365 .svg-container{
       background-color: $tkn_M365_color$;
       }
       #single_perc_m365 .single-result{
       fill: rgb(255,255,255)!important;
       font-size: 120px !important;
       }
       #single_perc_m365 .under-label {
          font-size: 25px !important;
          fill: rgb(255,255,255)!important;
       }
       </style>
     </html>
      <single id="single_perc_m365">
        <search>
          <query>
            | loadjob savedsearch="nobody:$tkn_current_app$:ssphp_create_dashboard_dataset"
            | search line_type="summary" AND ssphp.use_case.foundational_system="M365"
            | table compliant_perc, compliant_color
          </query>
          <done>
            <set token="tkn_M365_color">$result.compliant_color$</set>
          </done>
        </search>
        <option name="height">200</option>
        <option name="field">text_out</option>
        <option name="underLabel">M365</option>
        <option name="drilldown">all</option>
        <option name="unit">%</option>
        <drilldown>
          <link target="_blank">/app/$tkn_current_app$/ssphp_foundational_systems_service?form.tkn__service=m365</link>
        </drilldown>
      </single>
    </panel>
  </row>
</dashboard>
  