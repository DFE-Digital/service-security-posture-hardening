[ssphp_use_case_azure_002_cis_2-1-18]
cron_schedule = */30 * * * *
dispatch.earliest_time = 0
dispatch.latest_time = now
enableSched = 1
search = """
| `ssphp_use_case_azure_get_config_data("Microsoft.security/SecurityContact")`

| stats count as ssphp.score.denominator, 
        sum(eval(if('properties.alertNotifications.state'="On" AND 'properties.notificationsByRole.state'="On" AND like('properties.notificationsByRole.roles{}',"%Owner%"),1,0))) as ssphp.score.numerator
| eval ssphp.score.score='ssphp.score.numerator'*100/'ssphp.score.denominator'
| fields ssphp.score.score, ssphp.score.numerator, ssphp.score.denominator, id


``` ##################### add metadata ##################### ```
| eval SSPHP_RUN=round(now()),
       ssphp.use_case.id="azure_002_cis_2-1-18",

       ssphp.use_case.version.number="2.0.0",
       ssphp.use_case.version.last_changed_date="2023-10-05",
       ssphp.use_case.version.last_changed_by="Ian Pearl",
       
       ssphp.microsoft.description=coalesce('description',"-"),
       ssphp.microsoft.implementation_status=coalesce('implementationStatus',"-")

| lookup foundational_systems_use_case_metadata.csv ssphp.use_case.id

| eval ssphp.use_case.control=coalesce('ssphp.use_case.control','ssphp.cis_benchmark.control.title',"-"),
       ssphp.use_case.description=coalesce('ssphp.use_case.description','ssphp.cis_benchmark.control.description',"-")

```
| eval SSPHP_RUN=round(now()),
       ssphp.use_case.id="azure_002_cis_2-1-18",
       ssphp.use_case.display.title="Azure 002 [CIS 2.1.18]",
       ssphp.use_case.display.short_description="Security Alert Emails to Subscription Owners",
       ssphp.cis_benchmark.document.name="CIS Microsoft Azure Foundations Benchmark",
       ssphp.cis_benchmark.document.version="2.0.0",
       ssphp.cis_benchmark.document.date="14-02-2023",
       ssphp.cis_benchmark.control.number="2.1.18",
       ssphp.cis_benchmark.control.level="L1",
       ssphp.cis_benchmark.control.title="Ensure That 'All users with the following roles' is set to 'Owner'",
       ssphp.cis_benchmark.control.profile_applicability="Level 1",
       ssphp.cis_benchmark.control.description="Enable security alert emails to subscription owners.",
       ssphp.cis_benchmark.control.rationale="Enabling security alert emails to subscription owners ensures that they receive security alert emails from Microsoft. This ensures that they are aware of any potential security issues and can mitigate the risk in a timely fashion.",
       ssphp.cis_benchmark.control.impact="-",
       ssphp.cis_benchmark.controls.v8=mvappend(ssphp.cis_benchmark.controls.v8,"17.2 Establish and Maintain Contact Information for Reporting Security Incidents"),
       ssphp.cis_benchmark.controls.ig1="true",
       ssphp.cis_benchmark.controls.ig2="true",
       ssphp.cis_benchmark.controls.ig3="true",

       ssphp.microsoft.desciption="-",
       ssphp.microsoft.implementation_status='id',

       ssphp.use_case.description='ssphp.cis_benchmark.control.description',
       ssphp.use_case.control='ssphp.cis_benchmark.control.description'." : ".ssphp.cis_benchmark.control.rationale,

       ssphp.use_case.version="1.0.0",
       ssphp.use_case.last_changed.date="2023-10-04",
       ssphp.use_case.last_changed.by="Ian Pearl",
       ssphp.use_case.treshhold.red="-",
       ssphp.use_case.treshhold.orange="-",
       ssphp.use_case.treshhold.green="99",
       ssphp.color=case('ssphp.score.score'>'ssphp.use_case.treshhold.green',"green",1==1,"red"),
       ssphp.use_case.scoring_narrative="Score is 100 if control requirements are confirmed, otherwise 0. Best=100, Worst=0",
       ssphp.use_case.framework.mitre="Initial Access",
       ssphp.use_case.framework.ig_1="17.2",
       ssphp.use_case.framework.ig_2="17.2",
       ssphp.use_case.framework.ig_3="17.2",
       ssphp.cis_benchmark.version="CIS v8"
```

`ssphp_use_case_write`

"""
