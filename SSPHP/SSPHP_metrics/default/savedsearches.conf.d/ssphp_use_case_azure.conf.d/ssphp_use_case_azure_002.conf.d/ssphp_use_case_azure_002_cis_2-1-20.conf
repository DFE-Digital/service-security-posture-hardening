[ssphp_use_case_azure_002_cis_2-1-20]
cron_schedule = */30 * * * *
dispatch.earliest_time = 0
dispatch.latest_time = now
enableSched = 1
search = """
| `ssphp_use_case_azure_get_config_data("Microsoft.security/SecurityContact")`

| stats count as ssphp.score.denominator, 
        sum(eval(if('properties.alertNotifications.state'="On" AND 'properties.notificationsByRole.state'="On" AND 'properties.alertNotifications.minimalSeverity'="High",1,0))) as ssphp.score.numerator
| eval ssphp.score.score='ssphp.score.numerator'*100/'ssphp.score.denominator'
| fillnull value=0 ssphp.score.denominator, ssphp.score.numerator, ssphp.score.score
| fields ssphp.score.score, ssphp.score.numerator, ssphp.score.denominator, id


``` ##################### add metadata ##################### ```
| eval SSPHP_RUN=round(now()),
       ssphp.use_case.id="azure_002_cis_2-1-20",

       ssphp.use_case.version.number="2.0.0",
       ssphp.use_case.version.last_changed_date="2023-10-05",
       ssphp.use_case.version.last_changed_by="Ian Pearl",
       
       ssphp.microsoft.description=coalesce('description',"-"),
       ssphp.microsoft.implementation_status=coalesce('implementationStatus',"-")

| lookup foundational_systems_use_case_metadata.csv ssphp.use_case.id

| eval ssphp.use_case.control=coalesce('ssphp.use_case.control','ssphp.cis_benchmark.control.title',"-"),
       ssphp.use_case.description=coalesce('ssphp.use_case.description','ssphp.cis_benchmark.control.description',"-")

| eval ssphp.score.color=case('ssphp.score.score'>'ssphp.score.threshold.green',"green",1==1,"red")

```
| eval SSPHP_RUN=round(now()),
       ssphp.use_case.id="azure_002_cis_2-1-20",
       ssphp.use_case.display.title="Azure 002 [CIS 2.1.20]",
       ssphp.use_case.display.short_description="'Notify about alerts with the following severity' is Set to 'High'",
       ssphp.cis_benchmark.document.name="CIS Microsoft Azure Foundations Benchmark",
       ssphp.cis_benchmark.document.version="2.0.0",
       ssphp.cis_benchmark.document.date="14-02-2023",
       ssphp.cis_benchmark.control.number="2.1.20",
       ssphp.cis_benchmark.control.level="L1",
       ssphp.cis_benchmark.control.title=" Ensure That 'Notify about alerts with the following severity' is Set to 'High'",
       ssphp.cis_benchmark.control.profile_applicability="Level 1",
       ssphp.cis_benchmark.control.description="Enables emailing security alerts to the subscription owner or other designated security contact.",
       ssphp.cis_benchmark.control.rationale="Enabling security alert emails ensures that security alert emails are received from Microsoft. This ensures that the right people are aware of any potential security issues and are able to mitigate the risk.",
       ssphp.cis_benchmark.control.impact="-",
       ssphp.cis_benchmark.controls.v8=mvappend(ssphp.cis_benchmark.controls.v8,"13.11 Tune Security Event Alerting Thresholds"),
       ssphp.cis_benchmark.controls.ig1="false",
       ssphp.cis_benchmark.controls.ig2="false",
       ssphp.cis_benchmark.controls.ig3="true",

       ssphp.microsoft.desciption="-",
       ssphp.microsoft.implementation_status='id',

       ssphp.use_case.description='ssphp.cis_benchmark.control.description',
       ssphp.use_case.control='ssphp.cis_benchmark.control.description'." : ".ssphp.cis_benchmark.control.rationale,

       ssphp.use_case.version="1.0.0",
       ssphp.use_case.last_changed.date="2023-10-04",
       ssphp.use_case.last_changed.by="Ian Pearl",
       ssphp.use_case.treshhold.red="-",
       ssphp.use_case.treshhold.orange="-",
       ssphp.use_case.treshhold.green="99",
       ssphp.color=case('ssphp.score.score'>'ssphp.use_case.treshhold.green',"green",1==1,"red"),
       ssphp.use_case.scoring_narrative="Score is 100 if control requirements are confirmed, otherwise 0. Best=100, Worst=0",
       ssphp.use_case.framework.mitre="Initial Access",
       ssphp.use_case.framework.ig_1="-",
       ssphp.use_case.framework.ig_2="-",
       ssphp.use_case.framework.ig_3="13.11",
       ssphp.cis_benchmark.version="CIS v8"
```

`ssphp_use_case_write`

"""
