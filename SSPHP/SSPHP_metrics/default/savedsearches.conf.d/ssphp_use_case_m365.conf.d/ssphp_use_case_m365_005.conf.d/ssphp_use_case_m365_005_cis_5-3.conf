[ssphp_use_case_m365_005_cis_5-3]
cron_schedule = */30 * * * *
dispatch.earliest_time = 0
dispatch.latest_time = now
enableSched = 1
search = """
| `ssphp_use_case_m365_cis_powershell("m365:organization_config")`

| eval ssphp.score.score=if(AuditDisabled="false","100","0"),
       ssphp.score.numerator="-",
       ssphp.score.denominator="-"
| fields ssphp.score.score, ssphp.score.numerator, ssphp.score.denominator, description, implementationStatus


``` ##################### add metadata ##################### ```
| eval SSPHP_RUN=round(now()),
       ssphp.use_case.id="m365_005_cis_5-3",

       ssphp.use_case.version.number="2.0.0",
       ssphp.use_case.version.last_changed_date="2023-10-05",
       ssphp.use_case.version.last_changed_by="Ian Pearl",
       
       ssphp.microsoft.description=coalesce('description',"-"),
       ssphp.microsoft.implementation_status=coalesce('implementationStatus',"-")

| lookup foundational_systems_use_case_metadata.csv ssphp.use_case.id

| eval ssphp.use_case.control=coalesce('ssphp.use_case.control','ssphp.cis_benchmark.control.title',"-"),
       ssphp.use_case.description=coalesce('ssphp.use_case.description','ssphp.cis_benchmark.control.description',"-")

```
| eval SSPHP_RUN=round(now()),
       ssphp.use_case.id="m365_005_cis_5-3",
       ssphp.use_case.display.title="M365 005 [CIS 5.3]",
       ssphp.use_case.display.short_description="M365 Mailbox Auditing",
       ssphp.cis_benchmark.document.name="CIS Microsoft 365 Foundations Benchmark",
       ssphp.cis_benchmark.document.version="2.0.0",
       ssphp.cis_benchmark.document.date="31-03-2023",
       ssphp.cis_benchmark.control.number="5.3",
       ssphp.cis_benchmark.control.level="L1",
       ssphp.cis_benchmark.control.title="Ensure mailbox auditing for all users is Enabled",
       ssphp.cis_benchmark.control.profile_applicability="E3 Level 1",
       ssphp.cis_benchmark.control.description="By turning on mailbox auditing, Microsoft 365 back office teams can track logons to a mailbox as well as what actions are taken while the user is logged on. After you turn on mailbox audit logging for a mailbox, you can search the audit log for mailbox activity. Additionally, when mailbox audit logging is turned on, some actions performed by administrators, delegates, and owners are logged by default.",
       ssphp.cis_benchmark.control.rationale="Starting in January 2019, Microsoft is turning on mailbox audit logging by default for all organizations. This means that certain actions performed by mailbox owners, delegates, and admins are automatically logged, and the corresponding mailbox audit records will be available when you search for them in the mailbox audit log. When mailbox auditing on by default is turned on for the organization, the AuditEnabled property for affected mailboxes won't be changed from False to True. In other words, mailbox auditing on by default ignores the AuditEnabled property on mailboxes. However, only certain mailbox types support default auditing On : User Mailboxes, Shared Mailboxes, Microsoft 365 Group Mailboxes.  The remaining mailbox types require auditing be turned on at the mailbox level: Resource Mailboxes, Public Folder Mailboxes, DiscoverySearch Mailbox.  Whether it is for regulatory compliance or for tracking unauthorized configuration changes in Microsoft 365, enabling mailbox auditing allows for Microsoft 365 back office teams to run security operations, forensics or general investigations on mailbox activities.  NOTE: Without advanced auditing (E5 function) the logs are limited to 90 days.",
       ssphp.cis_benchmark.control.impact="-",
       ssphp.cis_benchmark.controls.v8=mvappend(ssphp.cis_benchmark.controls.v8,"8.2 Collect Audit Logs"),
       ssphp.cis_benchmark.controls.ig1="true",
       ssphp.cis_benchmark.controls.ig2="true",
       ssphp.cis_benchmark.controls.ig3="true",
       ssphp.microsoft.desciption='description',
       ssphp.microsoft.implementation_status='implementationStatus',

       ssphp.use_case.description='ssphp.cis_benchmark.control.description',
       ssphp.use_case.control='ssphp.cis_benchmark.control.description'." : ".ssphp.cis_benchmark.control.rationale,

       ssphp.use_case.version="1.0.0",
       ssphp.use_case.last_changed.date="2023-09-20",
       ssphp.use_case.last_changed.by="Ian Pearl",
       ssphp.use_case.treshhold.red="-",
       ssphp.use_case.treshhold.orange="-",
       ssphp.use_case.treshhold.green="99",
       ssphp.color=case('ssphp.score.score'>'ssphp.use_case.treshhold.green',"green",1==1,"red"),
       ssphp.use_case.scoring_narrative="Score is 100 if control requirements are confirmed, otherwise 0. Best=100, Worst=0",
       ssphp.use_case.framework.mitre="Initial Access",
       ssphp.use_case.framework.ig_1="8.2",
       ssphp.use_case.framework.ig_2="8.2",
       ssphp.use_case.framework.ig_3="8.2",
       ssphp.cis_benchmark.version="CIS v8"
```

`ssphp_use_case_write`

"""
