[ssphp_use_case_m365_002_cis_2-2]
cron_schedule = */30 * * * *
dispatch.earliest_time = 0
dispatch.latest_time = now
enableSched = 1
search = """
| `ssphp_use_case_m365_cis_secure_score("IntegratedApps")`


| eval numerator="-",
       denominator="-",
       ssphp.score.score=if(implementationStatus="You have no user consent policy in place.","0","100")
| fields ssphp.score.score, ssphp.score.numerator, ssphp.score.denominator, description, implementationStatus


``` ##################### add metadata ##################### ```
| eval SSPHP_RUN=round(now()),
       ssphp.use_case.id="m365_002_cis_2-2",

       ssphp.use_case.version.number="2.0.0",
       ssphp.use_case.version.last_changed_date="2023-10-05",
       ssphp.use_case.version.last_changed_by="Ian Pearl",
       
       ssphp.microsoft.description=coalesce('description',"-"),
       ssphp.microsoft.implementation_status=coalesce('implementationStatus',"-")

| lookup foundational_systems_use_case_metadata.csv ssphp.use_case.id

| eval ssphp.use_case.control=coalesce('ssphp.use_case.control','ssphp.cis_benchmark.control.title',"-"),
       ssphp.use_case.description=coalesce('ssphp.use_case.description','ssphp.cis_benchmark.control.description',"-")

```
| eval SSPHP_RUN=round(now()),
       ssphp.use_case.id="m365_002_cis_2-2",
       ssphp.use_case.display.title="M365 002 [CIS 2.2]",

       ssphp.cis_benchmark.document.name="CIS Microsoft 365 Foundations Benchmark",
       ssphp.cis_benchmark.document.version="2.0.0",
       ssphp.cis_benchmark.document.date="31-03-2023",
       ssphp.cis_benchmark.control.number="2.2",
       ssphp.cis_benchmark.control.level="L2",
       ssphp.cis_benchmark.control.title="Ensure the admin consent workflow is enabled",
       ssphp.cis_benchmark.control.profile_applicability="E3 Level 2",
       ssphp.cis_benchmark.control.description="App registrations allows users to register custom-developed applications for use within the directory.",
       ssphp.cis_benchmark.control.rationale="Third party integrated applications connection to services should be disabled, unless there is a very clear value and robust security controls are in place. While there are legitimate uses, attackers can grant access from breached accounts to third party applications to exfiltrate data from your tenancy without having to maintain the breached account.",
       ssphp.cis_benchmark.control.impact="Implementation of this change will impact both end users and administrators. End users will not be able to integrate third-party applications that they may wish to use. Administrators are likely to receive requests from end users to grant them permission to necessary third-party applications.",
       ssphp.cis_benchmark.controls.v8=mvappend(ssphp.cis_benchmark.controls.v8,"2.5 Allowlist Authorized Software"),
       ssphp.cis_benchmark.controls.ig1="false",
       ssphp.cis_benchmark.controls.ig2="true",
       ssphp.cis_benchmark.controls.ig3="true",
       ssphp.microsoft.desciption='description',
       ssphp.microsoft.implementation_status='implementationStatus',


       ssphp.use_case.display.short_description="Integrated Apps Not Allowed",
       ssphp.use_case.description='ssphp.cis_benchmark.control.description',
       ssphp.use_case.control='ssphp.cis_benchmark.control.description'." : ".ssphp.cis_benchmark.control.rationale,

       ssphp.use_case.version="1.0.0",
       ssphp.use_case.last_changed.date="2023-09-27",
       ssphp.use_case.last_changed.by="Ian Pearl",
       ssphp.use_case.treshhold.red="-",
       ssphp.use_case.treshhold.orange="-",
       ssphp.use_case.treshhold.green="99",
       ssphp.color=case('ssphp.score.score'>'ssphp.use_case.treshhold.green',"green",1==1,"red"),
       ssphp.use_case.scoring_narrative="Score is 100 if control requirements are confirmed, otherwise 0. Best=100, Worst=0",
       ssphp.use_case.framework.mitre="Initial Access",
       ssphp.use_case.framework.ig_1="-",
       ssphp.use_case.framework.ig_2="2.5",
       ssphp.use_case.framework.ig_3="2.5",
       ssphp.cis_benchmark.version="CIS v8"
```

`ssphp_use_case_write`

"""
