[ssphp_use_case_m365_001_cis_1-1-13]
cron_schedule = */30 * * * *
dispatch.earliest_time = 0
dispatch.latest_time = now
enableSched = 1
search = """
| `ssphp_use_case_m365_cis_secure_score("SigninRiskPolicy")`

| rex field=implementationStatus "You have (?<numerator>[^\s]*) of (?<denominator>[^\s]*) users that don't have the sign-in risky policy turned on"

| eval ssphp.score.numerator=numerator, 
       ssphp.score.denominator=denominator,
       ssphp.score.score=floor((denominator-numerator)*100/denominator)
| fillnull value=0 ssphp.score.score
| fillnull value="-" ssphp.score.numerator, ssphp.score.denominator
| fields ssphp.score.score, ssphp.score.numerator, ssphp.score.denominator, description, implementationStatus


``` ##################### add metadata ##################### ```
| eval SSPHP_RUN=round(now()),
       ssphp.use_case.id="m365_001_cis_1-1-13",

       ssphp.use_case.version.number="2.0.0",
       ssphp.use_case.version.last_changed_date="2023-10-05",
       ssphp.use_case.version.last_changed_by="Ian Pearl",
       
       ssphp.microsoft.description=coalesce('description',"-"),
       ssphp.microsoft.implementation_status=coalesce('implementationStatus',"-")

| lookup foundational_systems_use_case_metadata.csv ssphp.use_case.id

| eval ssphp.use_case.control=coalesce('ssphp.use_case.control','ssphp.cis_benchmark.control.title',"-"),
       ssphp.use_case.description=coalesce('ssphp.use_case.description','ssphp.cis_benchmark.control.description',"-")

| eval ssphp.score.color=case('ssphp.score.score'>'ssphp.score.threshold.green',"green",1==1,"red")

```
| eval SSPHP_RUN=round(now()),
       ssphp.use_case.id="m365_001_cis_1-1-13",
       ssphp.use_case.display.title="M365 001 [CIS 1.1.13]",
       ssphp.use_case.display.short_description="Identity Protection Sign-In Risk Policy",
       ssphp.cis_benchmark.document.name="CIS Microsoft 365 Foundations Benchmark",
       ssphp.cis_benchmark.document.version="2.0.0",
       ssphp.cis_benchmark.document.date="31-03-2023",
       ssphp.cis_benchmark.control.number="1.1.13",
       ssphp.cis_benchmark.control.level="L2",
       ssphp.cis_benchmark.control.title="Enable Azure AD Identity Protection sign-in risk policies",
       ssphp.cis_benchmark.control.profile_applicability="E5 Level 2",
       ssphp.cis_benchmark.control.description="Azure Active Directory Identity Protection sign-in risk detects risks in real-time and offline. A risky sign-in is an indicator for a sign-in attempt that might not have been performed by the legitimate owner of a user account.",
       ssphp.cis_benchmark.control.rationale="Turning on the sign-in risk policy ensures that suspicious sign-ins are challenged for multi-factor authentication.",
       ssphp.cis_benchmark.control.impact="When the policy triggers, the user will need MFA to access the account. In the case of a user who hasn't registered MFA on their account, they would be blocked from accessing their account. It is therefore recommended that the MFA registration policy be configured for all users who are a part of the Sign-in Risk policy.",
       ssphp.cis_benchmark.controls.v8=mvappend(ssphp.cis_benchmark.controls.v8,"13.3 Deploy a Network Intrusion Detection Solution"),
       ssphp.cis_benchmark.controls.ig1="false",
       ssphp.cis_benchmark.controls.ig2="true",
       ssphp.cis_benchmark.controls.ig3="true",
       ssphp.microsoft.desciption='description',
       ssphp.microsoft.implementation_status='implementationStatus',

       ssphp.use_case.description='ssphp.cis_benchmark.control.description',
       ssphp.use_case.control='ssphp.cis_benchmark.control.description'." : ".ssphp.cis_benchmark.control.rationale,

       ssphp.use_case.version="1.0.0",
       ssphp.use_case.last_changed.date="2023-09-27",
       ssphp.use_case.last_changed.by="Ian Pearl",
       ssphp.use_case.treshhold.red="-",
       ssphp.use_case.treshhold.orange="-",
       ssphp.use_case.treshhold.green="99",
       ssphp.color=case('ssphp.score.score'>'ssphp.use_case.treshhold.green',"green",1==1,"red"),
       ssphp.use_case.scoring_narrative="Score is 100 if control requirements are confirmed, otherwise 0. Best=100, Worst=0",
       ssphp.use_case.framework.mitre="Initial Access",
       ssphp.use_case.framework.ig_1="-",
       ssphp.use_case.framework.ig_2="13.3",
       ssphp.use_case.framework.ig_3="13.3",
       ssphp.cis_benchmark.version="CIS v8"
```

`ssphp_use_case_write`

"""
