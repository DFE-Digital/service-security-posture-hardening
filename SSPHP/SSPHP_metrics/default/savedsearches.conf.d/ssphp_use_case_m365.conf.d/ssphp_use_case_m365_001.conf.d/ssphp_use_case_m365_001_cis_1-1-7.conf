[ssphp_use_case_m365_001_cis_1-1-7]
cron_schedule = */30 * * * *
dispatch.earliest_time = 0
dispatch.latest_time = now
enableSched = 1
search = """
| `ssphp_use_case_m365_cis_secure_score("OneAdmin")`

| rex field=implementationStatus "You currently have (?<numerator>[^\s]*) global admins"

| eval ssphp.score.numerator=numerator, 
       ssphp.score.denominator="-",
       ssphp.score.score=if(numerator>1 AND numerator<=4,"100","0")
| fillnull value=0 ssphp.score.score
| fillnull value="-" ssphp.score.numerator, ssphp.score.denominator
| fields ssphp.score.score, ssphp.score.numerator, ssphp.score.denominator, description, implementationStatus


``` ##################### add metadata ##################### ```
| eval SSPHP_RUN=round(now()),
       ssphp.use_case.id="m365_001_cis_1-1-7",

       ssphp.use_case.version.number="2.0.0",
       ssphp.use_case.version.last_changed_date="2023-10-05",
       ssphp.use_case.version.last_changed_by="Ian Pearl",
       
       ssphp.microsoft.description=coalesce('description',"-"),
       ssphp.microsoft.implementation_status=coalesce('implementationStatus',"-")

| lookup foundational_systems_use_case_metadata.csv ssphp.use_case.id

| eval ssphp.use_case.control=coalesce('ssphp.use_case.control','ssphp.cis_benchmark.control.title',"-"),
       ssphp.use_case.description=coalesce('ssphp.use_case.description','ssphp.cis_benchmark.control.description',"-")

```
| eval SSPHP_RUN=round(now()),
       ssphp.use_case.id="m365_001_cis_1-1-7",
       ssphp.use_case.display.title="M365 001 [CIS 1.1.7]",
       ssphp.use_case.display.short_description="M365 Number of Global Admins",
       ssphp.cis_benchmark.document.name="CIS Microsoft 365 Foundations Benchmark",
       ssphp.cis_benchmark.document.version="2.0.0",
       ssphp.cis_benchmark.document.date="31-03-2023",
       ssphp.cis_benchmark.control.number="1.1.7",
       ssphp.cis_benchmark.control.level="L1",
       ssphp.cis_benchmark.control.title="Ensure that between two and four global admins are designated",
       ssphp.cis_benchmark.control.profile_applicability="E3 Level 1",
       ssphp.cis_benchmark.control.description="More than one global administrator should be designated so a single admin can be monitored and to provide redundancy should a single admin leave an organization. Additionally, there should be no more than four global admins set for any tenant. Ideally global administrators will have no licenses assigned to them.",
       ssphp.cis_benchmark.control.rationale="If there is only one global tenant administrator, he or she can perform malicious activity without the possibility of being discovered by another admin. If there are numerous global tenant administrators, the more likely it is that one of their accounts will be successfully breached by an external attacker.",
       ssphp.cis_benchmark.control.impact="The potential impact associated with ensuring compliance with this requirement is dependent upon the current number of global administrators configured in the tenant. If there is only one global administrator in a tenant, an additional global administrator will need to be identified and configured. If there are more than four global administrators, a review of role requirements for current global administrators will be required to identify which of the users require global administrator access.",
       ssphp.cis_benchmark.controls.v8=mvappend(ssphp.cis_benchmark.controls.v8,"5.1 Establish and Maintain an Inventory of Accounts"),
       ssphp.cis_benchmark.controls.ig1="true",
       ssphp.cis_benchmark.controls.ig2="true",
       ssphp.cis_benchmark.controls.ig3="true",
       ssphp.microsoft.desciption='description',
       ssphp.microsoft.implementation_status='implementationStatus',

       ssphp.use_case.description='ssphp.cis_benchmark.control.description',
       ssphp.use_case.control='ssphp.cis_benchmark.control.description'." : ".ssphp.cis_benchmark.control.rationale,

       ssphp.use_case.version="1.0.1",
       ssphp.use_case.last_changed.date="2023-09-22",
       ssphp.use_case.last_changed.by="Ian Pearl",
       ssphp.use_case.treshhold.red="-",
       ssphp.use_case.treshhold.orange="-",
       ssphp.use_case.treshhold.green="99",
       ssphp.color=case('ssphp.score.score'>'ssphp.use_case.treshhold.green',"green",1==1,"red"),
       ssphp.use_case.scoring_narrative="Score is 100 if control requirements are confirmed, otherwise 0. Best=100, Worst=0",
       ssphp.use_case.framework.mitre="Initial Access",
       ssphp.use_case.framework.ig_1="5.1",
       ssphp.use_case.framework.ig_2="5.1",
       ssphp.use_case.framework.ig_3="5.1",
       ssphp.cis_benchmark.version="CIS v8"
```

`ssphp_use_case_write`

"""
