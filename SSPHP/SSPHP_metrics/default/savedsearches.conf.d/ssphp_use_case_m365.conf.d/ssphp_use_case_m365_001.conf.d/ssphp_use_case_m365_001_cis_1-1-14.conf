[ssphp_use_case_m365_001_cis_1-1-14]
cron_schedule = */30 * * * *
dispatch.earliest_time = 0
dispatch.latest_time = now
enableSched = 1
search = """
| `ssphp_use_case_m365_cis_secure_score("UserRiskPolicy")`

| rex field=implementationStatus "You have (?<numerator>[^\s]*) users out of (?<denominator>[^\s]*) that do not have user risk policy enabled"

| eval ssphp.score.numerator=numerator, 
       ssphp.score.denominator=denominator,
       ssphp.score.score=floor((denominator-numerator)*100/denominator)
| fillnull value=0 ssphp.score.score
| fillnull value="-" ssphp.score.numerator, ssphp.score.denominator
| fields ssphp.score.score, ssphp.score.numerator, ssphp.score.denominator, description, implementationStatus

``` add metadata ```
| eval SSPHP_RUN=round(now()),
       ssphp.use_case.id="m365_001_cis_1-1-14",
       ssphp.use_case.display.title="M365 001 [CIS 1.1.14]",
       ssphp.use_case.display.short_description="Identity Protection User Risk Policies",
       ssphp.cis_benchmark.document.name="CIS Microsoft 365 Foundations Benchmark",
       ssphp.cis_benchmark.document.version="2.0.0",
       ssphp.cis_benchmark.document.date="31-03-2023",
       ssphp.cis_benchmark.control.number="1.1.14",
       ssphp.cis_benchmark.control.level="L2",
       ssphp.cis_benchmark.control.title="Enable Azure AD Identity Protection user risk policies",
       ssphp.cis_benchmark.control.profile_applicability="E5 Level 2",
       ssphp.cis_benchmark.control.description="Azure Active Directory Identity Protection user risk policies detect the probability that a user account has been compromised.",
       ssphp.cis_benchmark.control.rationale="With the user risk policy turned on, Azure AD detects the probability that a user account has been compromised. Administrators can configure a user risk conditional access policy to automatically respond to a specific user risk level.",
       ssphp.cis_benchmark.control.impact="Upon policy activation, account access will be either blocked or the user will be required to use MFA and change their password. Users without registered MFA will be denied access, necessitating an admin to recover the account. To avoid inconvenience, it is advised to configure the MFA registration policy for all users under the User Risk policy. Additionally, users identified in the Risky Users section will be affected by this policy. To gain a better understanding of the impact to the organization's environment, the list of Risky Users should be reviewed before enforcing the policy",
       ssphp.cis_benchmark.controls.v8=mvappend(ssphp.cis_benchmark.controls.v8,"13.3 Deploy a Network Intrusion Detection Solution"),
       ssphp.cis_benchmark.controls.ig1="false",
       ssphp.cis_benchmark.controls.ig2="true",
       ssphp.cis_benchmark.controls.ig3="true",
       ssphp.microsoft.desciption='description',
       ssphp.microsoft.implementation_status='implementationStatus',

       ssphp.use_case.description='ssphp.cis_benchmark.control.description',
       ssphp.use_case.control='ssphp.cis_benchmark.control.description'." : ".ssphp.cis_benchmark.control.rationale,

       ssphp.use_case.version="1.0.0",
       ssphp.use_case.last_changed.date="2023-09-27",
       ssphp.use_case.last_changed.by="Ian Pearl",
       ssphp.use_case.treshhold.red="-",
       ssphp.use_case.treshhold.orange="-",
       ssphp.use_case.treshhold.green="99",
       ssphp.color=case('ssphp.score.score'>'ssphp.use_case.treshhold.green',"green",1==1,"red"),
       ssphp.use_case.scoring_narrative="Score is 100 if control requirements are confirmed, otherwise 0. Best=100, Worst=0",
       ssphp.use_case.framework.mitre="Initial Access",
       ssphp.use_case.framework.ig_1="-",
       ssphp.use_case.framework.ig_2="13.3",
       ssphp.use_case.framework.ig_3="13.3",
       ssphp.cis_benchmark.version="CIS v8"
       
`ssphp_use_case_write`

"""
