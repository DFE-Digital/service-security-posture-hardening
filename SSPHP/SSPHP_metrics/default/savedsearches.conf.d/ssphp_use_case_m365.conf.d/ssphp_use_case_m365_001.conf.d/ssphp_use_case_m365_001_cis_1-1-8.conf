[ssphp_use_case_m365_001_cis_1-1-8]
cron_schedule = */30 * * * *
dispatch.earliest_time = 0
dispatch.latest_time = now
enableSched = 1
search = """
| `ssphp_use_case_m365_cis_secure_score("SelfServicePasswordReset")`

| rex field=implementationStatus "You have (?<numerator>[^\s]*) of (?<denominator>[^\s]*) users who don't have self-service password reset enabled"

| eval ssphp.score.numerator=numerator, 
       ssphp.score.denominator=denominator,
       ssphp.score.score=floor((denominator-numerator)*100/denominator)
| fillnull value=0 ssphp.score.score
| fillnull value="-" ssphp.score.numerator, ssphp.score.denominator
| fields ssphp.score.score, ssphp.score.numerator, ssphp.score.denominator

``` add metadata ```
| eval SSPHP_RUN=round(now()),
       ssphp.use_case.id="m365_001_cis_1-1-8",
       ssphp.use_case.display.title="M365 001 [CIS 1.1.8]",
       ssphp.use_case.display.short_description="Self service password reset",
       ssphp.cis_benchmark.document.name="CIS Microsoft 365 Foundations Benchmark",
       ssphp.cis_benchmark.document.version="2.0.0",
       ssphp.cis_benchmark.document.date="31-03-2023",
       ssphp.cis_benchmark.control.number="1.1.8",
       ssphp.cis_benchmark.control.level="L1",
       ssphp.cis_benchmark.control.title="Ensure 'Self service password reset enabled' is set to 'All'",
       ssphp.cis_benchmark.control.profile_applicability="E3 Level 1",
       ssphp.cis_benchmark.control.description="Enabling self-service password reset allows users to reset their own passwords in Azure AD. When users sign in to Microsoft 365, they will be prompted to enter additional contact information that will help them reset their password in the future. If combined registration is enabled additional information, outside of multi-factor, will not be needed.  NOTE: Effective Oct. 1st, 2022, Microsoft will begin to enable combined registration for all users in Azure AD tenants created before August 15th, 2020. Tenants created after this date are enabled with combined registration by default.",
       ssphp.cis_benchmark.control.rationale="Users will no longer need to engage the helpdesk for password resets, and the password reset mechanism will automatically block common, easily guessable passwords.",
       ssphp.cis_benchmark.control.impact="Users will be required to provide additional contact information to enroll in self-service password reset. Additionally, minor user education may be required for users that are used to calling a help desk for assistance with password resets.  NOTE: This is unavailable if using Azure AD Connect / Sync in a hybrid environment.",
       ssphp.cis_benchmark.controls.v8="-",
       ssphp.cis_benchmark.controls.ig1="false",
       ssphp.cis_benchmark.controls.ig2="true",
       ssphp.cis_benchmark.controls.ig3="true",

       ssphp.use_case.description='ssphp.cis_benchmark.control.description',
       ssphp.use_case.control='ssphp.cis_benchmark.control.description'." : ".ssphp.cis_benchmark.control.rationale,

       ssphp.use_case.version="1.0.0",
       ssphp.use_case.last_changed.date="2023-09-27",
       ssphp.use_case.last_changed.by="Ian Pearl",
       ssphp.use_case.treshhold.red="-",
       ssphp.use_case.treshhold.orange="-",
       ssphp.use_case.treshhold.green="99",
       ssphp.color=case('ssphp.score.score'>'ssphp.use_case.treshhold.green',"green",1==1,"red"),
       ssphp.use_case.scoring_narrative="Score is 100 if control requirements are confirmed, otherwise 0. Best=100, Worst=0",
       ssphp.use_case.framework.mitre="Initial Access",
       ssphp.use_case.framework.ig_1="-",
       ssphp.use_case.framework.ig_2="-",
       ssphp.use_case.framework.ig_3="-",
       ssphp.cis_benchmark.version="CIS v8"
       
`ssphp_use_case_write`

"""
