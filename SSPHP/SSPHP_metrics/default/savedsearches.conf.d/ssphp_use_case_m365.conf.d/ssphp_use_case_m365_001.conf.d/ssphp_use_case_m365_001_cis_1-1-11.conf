[ssphp_use_case_m365_001_cis_1-1-11]
cron_schedule = */30 * * * *
dispatch.earliest_time = 0
dispatch.latest_time = now
enableSched = 1
search = """
| `ssphp_use_case_m365_cis_secure_score("BlockLegacyAuthentication")`

| rex field=implementationStatus "You have (?<numerator>[^\s]*) of (?<denominator>[^\s]*) users that don't have legacy authentication blocked"

| eval ssphp.score.numerator=numerator, 
       ssphp.score.denominator=denominator,
       ssphp.score.score=floor((denominator-numerator)*100/denominator)
| fillnull value=0 ssphp.score.score
| fillnull value="-" ssphp.score.numerator, ssphp.score.denominator
| fields ssphp.score.score, ssphp.score.numerator, ssphp.score.denominator, description, implementationStatus


``` ##################### add metadata ##################### ```
| eval SSPHP_RUN=round(now()),
       ssphp.use_case.id="m365_001_cis_1-1-11",

       ssphp.use_case.version.number="2.0.0",
       ssphp.use_case.version.last_changed_date="2023-10-05",
       ssphp.use_case.version.last_changed_by="Ian Pearl",
       
       ssphp.microsoft.description=coalesce('description',"-"),
       ssphp.microsoft.implementation_status=coalesce('implementationStatus',"-")

| lookup foundational_systems_use_case_metadata.csv ssphp.use_case.id

| eval ssphp.use_case.control=coalesce('ssphp.use_case.control','ssphp.cis_benchmark.control.title',"-"),
       ssphp.use_case.description=coalesce('ssphp.use_case.description','ssphp.cis_benchmark.control.description',"-")

```
| eval SSPHP_RUN=round(now()),
       ssphp.use_case.id="m365_001_cis_1-1-11",
       ssphp.use_case.display.title="M365 001 [CIS 1.1.11]",
       ssphp.use_case.display.short_description="M365 Block Legacy Authentication",
       ssphp.cis_benchmark.document.name="CIS Microsoft 365 Foundations Benchmark",
       ssphp.cis_benchmark.document.version="2.0.0",
       ssphp.cis_benchmark.document.date="31-03-2023",
       ssphp.cis_benchmark.control.number="1.1.11",
       ssphp.cis_benchmark.control.level="L1",
       ssphp.cis_benchmark.control.title="Enable Conditional Access policies to block legacy authentication",
       ssphp.cis_benchmark.control.profile_applicability="E3 Level 1",
       ssphp.cis_benchmark.control.description="Azure AD supports the most widely used authentication and authorization protocols including legacy authentication. This authentication pattern includes basic authentication, a widely used industry-standard method for collecting user name and password information.",
       ssphp.cis_benchmark.control.rationale="Legacy authentication protocols do not support multi-factor authentication. These protocols are often used by attackers because of this deficiency. Blocking legacy authentication makes it harder for attackers to gain access.  NOTE: As of October 2022 Microsoft began disabling basic authentication in all tenants, except for those who requested special exceptions it should no longer be available in most tenants beyond Dec 31, 2022. Despite this CIS recommends the CA policy to remain in place to act as a defense in depth measure.",
       ssphp.cis_benchmark.control.impact="Enabling this setting will prevent users from connecting with older versions of Office, ActiveSync or using protocols like IMAP, POP or SMTP and may require upgrades to older versions of Office, and use of mobile mail clients that support modern authentication.",
       ssphp.cis_benchmark.controls.v8=mvappend(ssphp.cis_benchmark.controls.v8,"4.8 Uninstall or Disable Unnecessary Services on Enterprise Assets and Software"),
       ssphp.cis_benchmark.controls.ig1="false",
       ssphp.cis_benchmark.controls.ig2="true",
       ssphp.cis_benchmark.controls.ig3="true",
       ssphp.microsoft.desciption='description',
       ssphp.microsoft.implementation_status='implementationStatus',

       ssphp.use_case.description='ssphp.cis_benchmark.control.description',
       ssphp.use_case.control='ssphp.cis_benchmark.control.description'." : ".ssphp.cis_benchmark.control.rationale,

       ssphp.use_case.version="1.0.1",
       ssphp.use_case.last_changed.date="2023-09-22",
       ssphp.use_case.last_changed.by="Ian Pearl",
       ssphp.use_case.treshhold.red="-",
       ssphp.use_case.treshhold.orange="-",
       ssphp.use_case.treshhold.green="99",
       ssphp.color=case('ssphp.score.score'>'ssphp.use_case.treshhold.green',"green",1==1,"red"),
       ssphp.use_case.scoring_narrative="Score is 100 if control requirements are confirmed, otherwise 0. Best=100, Worst=0",
       ssphp.use_case.framework.mitre="Initial Access",
       ssphp.use_case.framework.ig_1="-",
       ssphp.use_case.framework.ig_2="4.8",
       ssphp.use_case.framework.ig_3="4.8",
       ssphp.cis_benchmark.version="CIS v8"
```

`ssphp_use_case_write`

"""
